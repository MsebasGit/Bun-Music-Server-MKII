<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acerca del Artista</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="/js/utilities.js"></script>
</head>

<body>
    <header id="artist-header"></header>
    <nav id="artist-bar-container"></nav>
    <hr>

    <main>
        <section id="description-section">
            <h2>Descripción</h2>
            <p id="artist-bio"></p>
        </section>

        <section id="links-section">
            <h2>Vínculos</h2>
            <div id="social-links-container"></div>
        </section>

        <section id="more-info-section">
            <h2>Más información</h2>
            <div id="more-info-container" class="more-info"></div>
        </section>
    </main>
    <button onclick="window.location.href='/artists';" class="btn btn-browse">Volver a artistas</button>

    <script>
        /**
         * Inicializa la página: obtiene todos los detalles del artista y los renderiza.
         * @param {string} artistId - El ID del artista.
         */
        async function initPage(artistId) {
            try {
                // 1. Cargar datos primarios del artista para obtener el ID de usuario
                const artist = await fetchData(`/get/artists/${artistId}`);

                // 2. Renderizar el encabezado y la barra de navegación
                document.getElementById('artist-header').innerHTML = `<h1>${artist.name}</h1>`;
                loadArtistBar(artistId, 'artist-bar-container');

                // 3. Renderizar la biografía
                document.getElementById('artist-bio').textContent = artist.biography || 'No hay biografía disponible.';

                // 4. Cargar datos secundarios (redes sociales y detalles de usuario) en paralelo
                const [socialNetworks, user] = await Promise.all([
                    fetchData(`/get/artists/${artistId}/social-networks`),
                    fetchData(`/get/users/${artist.id_user}`)
                ]);

                // 5. Renderizar los vínculos de redes sociales
                const linksContainer = document.getElementById('social-links-container');
                if (socialNetworks && socialNetworks.length > 0) {
                    linksContainer.innerHTML = socialNetworks.map(net => `
                        <div class="link-item">
                            <p> <b>${net.name} </b> </p>
                            <a href="${net.url}" target="_blank" rel="noopener noreferrer">${net.url}</a>
                        </div>
                    `).join('');
                } else {
                    linksContainer.innerHTML = '<p>No hay vínculos disponibles.</p>';
                }

                // 6. Renderizar la sección "Más información"
                const moreInfoContainer = document.getElementById('more-info-container');
                let moreInfoHTML = '';
                if (artist.nationality) {
                    moreInfoHTML += `<p><strong>Nacionalidad:</strong> ${artist.nationality}</p>`;
                }
                if (artist.debut_date) {
                    moreInfoHTML += `<p><strong>Debut:</strong> ${new Date(artist.debut_date).toLocaleDateString()}</p>`;
                }
                if (user && user.email) {
                    moreInfoHTML += `<p><strong>Contacto:</strong> <a href="mailto:${user.email}">${user.email}</a></p>`;
                }
                moreInfoContainer.innerHTML = moreInfoHTML || '<p>No hay más información disponible.</p>';

            } catch (error) {
                console.error('Error al inicializar la página de "Acerca de":', error);
                document.querySelector('main').innerHTML = '<p>Error al cargar la información. Por favor, inténtalo de nuevo más tarde.</p>';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const artistId = getIdFromUrl(-2); // De /artists/{id}/social-networks
            if (artistId) {
                initPage(artistId);
            } else {
                document.body.innerHTML = '<h1>Error: No se pudo determinar el ID del artista desde la URL.</h1>';
            }
        });
    </script>
</body>

</html>