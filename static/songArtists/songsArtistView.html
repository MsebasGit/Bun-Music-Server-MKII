<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canciones del Artista</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="/js/utilities.js"></script>
</head>

<body>
    <header id="artist-header"></header>
    <nav id="artist-bar-container"></nav>
    <hr>
    
    <button id="play-all-btn" class="btn btn-play btn-lavender" style="display: none;">Reproducir Todas</button>
    <button onclick="window.location.href='/artists';" class="btn btn-lavender">Volver a artistas</button>

    <div id="music-player" style="display: none; margin-top: 20px; text-align: center;">
        <h3 id="current-song-title"></h3>
        <audio id="audio-player" controls style="width: 100%;"></audio>
        <div>
            <button id="prev-btn" class="btn btn-lavender">Anterior</button>
            <button id="next-btn" class="btn btn-lavender">Siguiente</button>
        </div>
    </div>

    <main>
        <h2>Canciones</h2>
        <div class="card-container" id="song-list-container"></div>
    </main>

    <script>
        let musicPlayer;
        const cardColors = ['card-blue', 'card-green', 'card-yellow', 'card-red'];
        
        async function initPage(artistId) {
            try {
                const [artist, songs] = await Promise.all([
                    fetchData(`/get/artists/${artistId}`),
                    fetchData(`/get/artists/${artistId}/songs`)
                ]);

                const header = document.getElementById('artist-header');
                header.innerHTML = `<h1>${artist.name}</h1>`;
                loadArtistBar(artistId, 'artist-bar-container');

                const songsContainer = document.getElementById('song-list-container');
                if (songs && songs.length > 0) {
                    songsContainer.innerHTML = songs.map((song, index) => {
                        const colorClass = cardColors[index % cardColors.length];
                        return `
                        <div class="card ${colorClass}" data-song-id="${song.id_song}">
                            <a href="/songs/${song.id_song}">
                                <img src="${song.cover_path}" alt="Cover for ${song.title}">
                                <h3>${song.title}</h3>
                            </a>
                        </div>
                    `}).join('');
                    musicPlayer.updateSongs(songs);
                } else {
                    songsContainer.innerHTML = '<p>Este artista aún no tiene canciones.</p>';
                    musicPlayer.updateSongs([]);
                }

            } catch (error) {
                console.error('Error al inicializar la página de canciones:', error);
                document.querySelector('main').innerHTML = '<p>Error al cargar la información. Por favor, inténtalo de nuevo más tarde.</p>';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const artistId = getIdFromUrl(-2);
            if (artistId) {
                musicPlayer = new MusicPlayer({
                    songs: [],
                    playerElementId: 'music-player',
                    audioElementId: 'audio-player',
                    titleElementId: 'current-song-title',
                    prevButtonId: 'prev-btn',
                    nextButtonId: 'next-btn',
                    playAllButtonId: 'play-all-btn'
                });
                initPage(artistId);
            } else {
                document.body.innerHTML = '<h1>Error: No se pudo determinar el ID del artista desde la URL.</h1>';
            }
        });
    </script>
</body>

</html>